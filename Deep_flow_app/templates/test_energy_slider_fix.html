<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Slider Test - Fix</title>
    <link rel="stylesheet" href="/static/css/energy-insights.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-info {
            background: #f0f0f0;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            font-family: monospace;
        }
        .current-values {
            background: #e7f3ff;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            border-left: 4px solid #4facfe;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Energy Slider Fix Test</h1>
        <p>Testing sliders starting at 5 and updating properly when moved left (decrease) or right (increase)</p>
        
        <form id="add-energy-insight-form">
            <div class="energy-insights-form-layout">
                <!-- Row 1: Energy and Focus Levels -->
                <div class="form-row">
                    <div class="form-group half-width">
                        <label for="energy-level">
                            <i class="fas fa-battery-three-quarters"></i> Energy Level
                        </label>
                        <div class="slider-container">
                            <input type="range" id="energy-level" name="energy_level" min="1" max="10" value="5" class="energy-slider">
                            <div class="slider-labels">
                                <span>Low (1)</span>
                                <span class="energy-value">5</span>
                                <span>High (10)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group half-width">
                        <label for="focus-level">
                            <i class="fas fa-bullseye"></i> Focus Level
                        </label>
                        <div class="slider-container">
                            <input type="range" id="focus-level" name="focus_level" min="1" max="10" value="5" class="energy-slider">
                            <div class="slider-labels">
                                <span>Scattered (1)</span>
                                <span class="energy-value">5</span>
                                <span>Sharp (10)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        
        <div class="current-values">
            <h3>Current Values:</h3>
            <div id="live-values">
                <p>Energy Level: <strong id="energy-display">5</strong>/10</p>
                <p>Focus Level: <strong id="focus-display">5</strong>/10</p>
            </div>
        </div>
        
        <div class="debug-info">
            <h3>Debug Information:</h3>
            <div id="debug-output">
                <p>Initialized with default values</p>
            </div>
        </div>
    </div>

    <script>
        // Test the exact same logic as in the main application
        function initializeEnergyInsightsForm() {
            console.log('Starting slider initialization...');
            
            const form = document.getElementById('add-energy-insight-form');
            if (!form) {
                console.error('Form not found!');
                return;
            }
            
            console.log('Form found:', form);
            
            // Handle slider value updates
            const sliders = form.querySelectorAll('.energy-slider');
            console.log('Found sliders:', sliders.length);
            
            sliders.forEach((slider, index) => {
                console.log(`Processing slider ${index}:`, slider.id, 'value:', slider.value);
                
                // Find the correct value span - it's in the slider-labels div
                const sliderContainer = slider.closest('.slider-container');
                console.log(`Slider container ${index}:`, sliderContainer);
                
                const valueSpan = sliderContainer ? sliderContainer.querySelector('.energy-value') : null;
                console.log(`Value span ${index}:`, valueSpan);
                
                if (valueSpan) {
                    // Set initial value
                    valueSpan.textContent = slider.value;
                    console.log(`Set initial value for slider ${index}: ${slider.value}`);
                    
                    // Update on input
                    slider.addEventListener('input', function() {
                        console.log(`Slider ${index} moved to: ${this.value}`);
                        valueSpan.textContent = this.value;
                        
                        // Update live display
                        updateLiveDisplay();
                        
                        // Update debug output
                        document.getElementById('debug-output').innerHTML = `
                            <p>Last update: ${new Date().toLocaleTimeString()}</p>
                            <p>Slider ${index} (${this.id}): ${this.value}/10</p>
                            <p>Direction: ${this.value > 5 ? 'Right (Increase)' : this.value < 5 ? 'Left (Decrease)' : 'Center'}</p>
                        `;
                    });
                    
                    // Also handle 'change' event
                    slider.addEventListener('change', function() {
                        console.log(`Slider ${index} final value: ${this.value}`);
                    });
                    
                } else {
                    console.error(`No value span found for slider ${index}`);
                }
            });
            
            // Update live display initially
            updateLiveDisplay();
        }
        
        function updateLiveDisplay() {
            const energyValue = document.getElementById('energy-level').value;
            const focusValue = document.getElementById('focus-level').value;
            
            document.getElementById('energy-display').textContent = energyValue;
            document.getElementById('focus-display').textContent = focusValue;
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing sliders...');
            initializeEnergyInsightsForm();
            
            // Test that sliders work immediately
            setTimeout(() => {
                console.log('Testing programmatic slider changes...');
                document.getElementById('energy-level').value = 7;
                document.getElementById('energy-level').dispatchEvent(new Event('input'));
                
                setTimeout(() => {
                    document.getElementById('focus-level').value = 3;
                    document.getElementById('focus-level').dispatchEvent(new Event('input'));
                }, 1000);
            }, 2000);
        });
    </script>
</body>
</html>
